<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intermediate - Game Dev Math Guide</title>
    <link rel="stylesheet" href="shared/styles.css">
</head>
<body>
    <div class="container">
        <h1>üéÆ Intermediate Game Math</h1>
        <p class="subtitle">Core systems - Physics, collision detection, and visual effects</p>

        <!-- Navigation -->
        <div class="nav">
            <a href="beginner.html" class="nav-button">‚Üê Beginner</a>
            <a href="intermediate.html" class="nav-button active">Intermediate</a>
            <a href="advanced.html" class="nav-button">Advanced ‚Üí</a>
        </div>

        <!-- Table of Contents -->
        <div class="toc">
            <div class="toc-title">üìö Topics in This Guide</div>
            <ul>
                <li><a href="#lerp">Linear Interpolation (Lerp)</a></li>
                <li><a href="#physics">Physics Systems with Forces</a></li>
                <li><a href="#spaceship">Spaceship Controller with Gravity Wells</a></li>
                <li><a href="#spring">Spring Physics & Damping</a></li>
                <li><a href="#verlet">Verlet Physics & Constraints</a></li>
                <li><a href="#procedural-animation">Procedural Animation</a></li>
                <li><a href="#wave-simulation">Wave Simulation</a></li>
                <li><a href="#friction">Friction & Drag Systems</a></li>
                <li><a href="#collision">Collision Detection</a></li>
                <li><a href="#reflection">Bouncing & Reflection</a></li>
                <li><a href="#raycasting">Raycasting & Line of Sight</a></li>
                <li><a href="#particles">Particle Systems</a></li>
                <li><a href="#advanced-particles">Advanced Particle Effects</a></li>
            </ul>
        </div>

        <!-- LINEAR INTERPOLATION -->
        <div id="lerp" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üéØ Linear Interpolation (Lerp)</h2>

            <div class="concept-box">
                <h4>What is Lerp?</h4>
                <p>Lerp smoothly transitions between two values. It's the secret behind smooth camera movement, object animations, and color transitions!</p>
                <div class="formula">
                    result = start + (end - start) * t
                </div>
                <p>Where <code>t</code> is a value between 0 and 1:</p>
                <ul>
                    <li><strong>t = 0:</strong> Returns start value</li>
                    <li><strong>t = 0.5:</strong> Returns halfway between start and end</li>
                    <li><strong>t = 1:</strong> Returns end value</li>
                </ul>
            </div>

            <details>
                <summary>üìù Click to see: Lerp Implementation</summary>
                <div class="code-container">
                    <pre><code><span class="comment">// Basic lerp function</span>
<span class="keyword">function</span> <span class="function">lerp</span>(start, end, t) {
    <span class="keyword">return</span> start + (end - start) * t;
}

<span class="comment">// Vector lerp</span>
Vector2D.prototype.<span class="function">lerp</span> = <span class="keyword">function</span>(target, t) {
    <span class="keyword">this</span>.x += (target.x - <span class="keyword">this</span>.x) * t;
    <span class="keyword">this</span>.y += (target.y - <span class="keyword">this</span>.y) * t;
    <span class="keyword">return</span> <span class="keyword">this</span>;
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéÆ Smooth Camera Follow:</h4>
                    <pre><code><span class="keyword">class</span> <span class="function">Camera</span> {
    <span class="keyword">constructor</span>() {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);
    }

    <span class="function">follow</span>(target, smoothing = <span class="number">0.1</span>) {
        <span class="comment">// Smoothly move camera toward target</span>
        <span class="keyword">this</span>.position.<span class="function">lerp</span>(target, smoothing);
    }
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Lerp in Action</h3>
            <div class="diagram">
                <canvas id="lerpDemo" width="800" height="400"></canvas>
            </div>
            <div class="controls">
                <button id="btnSlowLerp">Slow (t=0.02)</button>
                <button id="btnMediumLerp">Medium (t=0.1)</button>
                <button id="btnFastLerp">Fast (t=0.3)</button>
                <button id="btnResetLerp">Reset</button>
            </div>
            <div id="lerpInfo" class="info-display">Click anywhere to set a new target</div>

            <div class="key-point">
                <strong>üí° Pro Tip:</strong> Smaller t values (0.01-0.05) create slower, smoother movement. Larger values (0.2-0.5) are snappier. Never use t >= 1 in lerp - it can cause overshooting!
            </div>
        </div>

        <!-- PHYSICS SYSTEMS -->
        <div id="physics" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>‚ö° Physics Systems with Forces</h2>

            <div class="concept-box">
                <h4>Basic Physics Principles</h4>
                <p>Game physics is based on Newton's laws:</p>
                <ul>
                    <li><strong>Position:</strong> Where the object is</li>
                    <li><strong>Velocity:</strong> How fast it's moving (and in what direction)</li>
                    <li><strong>Acceleration:</strong> How velocity changes over time</li>
                    <li><strong>Force:</strong> What causes acceleration (gravity, wind, etc.)</li>
                </ul>
                <div class="formula">
                    Force = Mass √ó Acceleration
                </div>
            </div>

            <details>
                <summary>üìù Click to see: Physics Entity Class</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">PhysicsEntity</span> {
    <span class="keyword">constructor</span>(x, y, mass = <span class="number">1</span>) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.velocity = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);
        <span class="keyword">this</span>.acceleration = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);
        <span class="keyword">this</span>.mass = mass;
    }

    <span class="function">applyForce</span>(force) {
        <span class="comment">// F = ma, so a = F/m</span>
        <span class="keyword">const</span> f = force.<span class="function">copy</span>().<span class="function">divide</span>(<span class="keyword">this</span>.mass);
        <span class="keyword">this</span>.acceleration.<span class="function">add</span>(f);
    }

    <span class="function">update</span>() {
        <span class="comment">// Update velocity based on acceleration</span>
        <span class="keyword">this</span>.velocity.<span class="function">add</span>(<span class="keyword">this</span>.acceleration);

        <span class="comment">// Update position based on velocity</span>
        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);

        <span class="comment">// Reset acceleration (forces are applied each frame)</span>
        <span class="keyword">this</span>.acceleration.<span class="function">multiply</span>(<span class="number">0</span>);
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéÆ Adding Gravity:</h4>
                    <pre><code><span class="keyword">const</span> gravity = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0.5</span>);  <span class="comment">// Downward force</span>

<span class="keyword">function</span> <span class="function">gameLoop</span>() {
    entities.<span class="function">forEach</span>(entity => {
        entity.<span class="function">applyForce</span>(gravity);
        entity.<span class="function">update</span>();
    });
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Physics Simulation</h3>
            <div class="diagram">
                <canvas id="physicsDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnAddBall">Add Ball</button>
                <button id="btnToggleGravity">Toggle Gravity</button>
                <button id="btnAddWind">Add Wind</button>
                <button id="btnResetPhysics">Reset</button>
            </div>
            <div id="physicsInfo" class="info-display">Click to apply force to nearby objects</div>
        </div>

        <!-- SPACESHIP CONTROLLER -->
        <div id="spaceship" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üöÄ Spaceship Controller with Gravity Wells</h2>

            <div class="concept-box">
                <h4>Thrust-Based Movement</h4>
                <p>Unlike direct position control, spaceships use thrust to accelerate. This creates realistic momentum and inertia:</p>
                <ul>
                    <li><strong>Thrust:</strong> Apply force in the direction the ship is facing</li>
                    <li><strong>Rotation:</strong> Turn the ship to change thrust direction</li>
                    <li><strong>Gravity Wells:</strong> Massive objects that pull the ship toward them</li>
                    <li><strong>Orbital Mechanics:</strong> Balance thrust and gravity to achieve orbit</li>
                </ul>
                <div class="formula">
                    Gravitational Force = G √ó (m‚ÇÅ √ó m‚ÇÇ) / distance¬≤
                </div>
            </div>

            <details>
                <summary>üìù Click to see: Spaceship Implementation</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">Spaceship</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.velocity = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);
        <span class="keyword">this</span>.acceleration = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);

        <span class="keyword">this</span>.angle = <span class="number">0</span>;  <span class="comment">// Direction ship is facing</span>
        <span class="keyword">this</span>.rotation = <span class="number">0</span>;  <span class="comment">// Angular velocity</span>

        <span class="keyword">this</span>.mass = <span class="number">1</span>;
        <span class="keyword">this</span>.thrustPower = <span class="number">0.15</span>;
        <span class="keyword">this</span>.rotationSpeed = <span class="number">0.08</span>;
    }

    <span class="function">applyForce</span>(force) {
        <span class="comment">// F = ma, so a = F/m</span>
        <span class="keyword">const</span> f = force.<span class="function">copy</span>().<span class="function">divide</span>(<span class="keyword">this</span>.mass);
        <span class="keyword">this</span>.acceleration.<span class="function">add</span>(f);
    }

    <span class="function">thrust</span>() {
        <span class="comment">// Apply force in the direction ship is facing</span>
        <span class="keyword">const</span> thrustForce = <span class="keyword">new</span> <span class="function">Vector2D</span>(
            Math.<span class="function">cos</span>(<span class="keyword">this</span>.angle) * <span class="keyword">this</span>.thrustPower,
            Math.<span class="function">sin</span>(<span class="keyword">this</span>.angle) * <span class="keyword">this</span>.thrustPower
        );
        <span class="keyword">this</span>.<span class="function">applyForce</span>(thrustForce);
    }

    <span class="function">rotateLeft</span>() {
        <span class="keyword">this</span>.rotation = -<span class="keyword">this</span>.rotationSpeed;
    }

    <span class="function">rotateRight</span>() {
        <span class="keyword">this</span>.rotation = <span class="keyword">this</span>.rotationSpeed;
    }

    <span class="function">update</span>() {
        <span class="comment">// Update rotation</span>
        <span class="keyword">this</span>.angle += <span class="keyword">this</span>.rotation;
        <span class="keyword">this</span>.rotation *= <span class="number">0.9</span>;  <span class="comment">// Damping</span>

        <span class="comment">// Update physics</span>
        <span class="keyword">this</span>.velocity.<span class="function">add</span>(<span class="keyword">this</span>.acceleration);
        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);

        <span class="comment">// Reset acceleration</span>
        <span class="keyword">this</span>.acceleration.<span class="function">multiply</span>(<span class="number">0</span>);
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéÆ Gravity Well Physics:</h4>
                    <pre><code><span class="keyword">class</span> <span class="function">GravityWell</span> {
    <span class="keyword">constructor</span>(x, y, mass = <span class="number">100</span>) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.mass = mass;
        <span class="keyword">this</span>.radius = Math.<span class="function">sqrt</span>(mass) * <span class="number">2</span>;
    }

    <span class="function">attract</span>(entity) {
        <span class="comment">// Calculate direction to gravity well</span>
        <span class="keyword">const</span> force = <span class="keyword">this</span>.position.<span class="function">copy</span>().<span class="function">subtract</span>(entity.position);
        <span class="keyword">const</span> distance = <span class="function">clamp</span>(force.<span class="function">length</span>(), <span class="number">5</span>, <span class="number">100</span>);

        <span class="comment">// Newton's law of gravitation: F = G √ó (m1 √ó m2) / r¬≤</span>
        <span class="keyword">const</span> G = <span class="number">1</span>;  <span class="comment">// Gravitational constant (simplified)</span>
        <span class="keyword">const</span> strength = (G * <span class="keyword">this</span>.mass * entity.mass) / (distance * distance);

        force.<span class="function">normalize</span>().<span class="function">multiply</span>(strength);
        entity.<span class="function">applyForce</span>(force);
    }
}

<span class="comment">// In game loop:</span>
<span class="keyword">function</span> <span class="function">update</span>() {
    <span class="comment">// Apply gravity from all wells</span>
    gravityWells.<span class="function">forEach</span>(well => {
        well.<span class="function">attract</span>(spaceship);
    });

    spaceship.<span class="function">update</span>();
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Spaceship with Gravity Wells</h3>
            <div class="diagram">
                <canvas id="spaceshipDemo" width="800" height="600"></canvas>
            </div>
            <div class="controls">
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 600px; margin: 0 auto;">
                    <button id="btnSpaceshipThrust">üî• Thrust (W)</button>
                    <button id="btnSpaceshipLeft">‚¨ÖÔ∏è Rotate Left (A)</button>
                    <button id="btnSpaceshipRight">‚û°Ô∏è Rotate Right (D)</button>
                    <button id="btnAddGravityWell">‚ûï Add Gravity Well</button>
                    <button id="btnRemoveGravityWell">‚ûñ Remove Gravity Well</button>
                    <button id="btnResetSpaceship">üîÑ Reset</button>
                </div>
            </div>
            <div id="spaceshipInfo" class="info-display">Use W/A/D or buttons to control the spaceship. Click to add gravity wells. Try to achieve orbit!</div>

            <div class="key-point">
                <strong>üí° Orbital Mechanics:</strong> To orbit a gravity well, you need the right speed and direction! Too slow = you'll crash. Too fast = you'll fly away. The perfect orbit is when centrifugal force (your velocity) balances gravitational pull. Try flying perpendicular to a gravity well at medium speed!
            </div>

            <div class="challenge-box">
                <h4>üèÜ Challenges:</h4>
                <ul>
                    <li><strong>Stable Orbit:</strong> Achieve a circular orbit around a single gravity well</li>
                    <li><strong>Figure-8:</strong> Navigate between two gravity wells in a figure-8 pattern</li>
                    <li><strong>Slingshot:</strong> Use a gravity well's pull to boost your speed (gravity assist maneuver)</li>
                    <li><strong>Landing:</strong> Slow down enough to gently touch a gravity well</li>
                </ul>
            </div>
        </div>

        <!-- SPRING PHYSICS -->
        <div id="spring" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üîÑ Spring Physics & Damping</h2>

            <div class="concept-box">
                <h4>What are Springs?</h4>
                <p>Springs create smooth, bouncy motion that feels natural and responsive. They're perfect for:</p>
                <ul>
                    <li>Camera following (smooth but snappy)</li>
                    <li>UI animations (buttons, menus)</li>
                    <li>Rope/chain physics</li>
                    <li>Elastic connections between objects</li>
                </ul>
                <p><strong>Hooke's Law:</strong> Force = -stiffness √ó displacement</p>
            </div>

            <details>
                <summary>üìù Click to see: Spring Implementation</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">Spring</span> {
    <span class="keyword">constructor</span>(stiffness = <span class="number">0.1</span>, damping = <span class="number">0.8</span>) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);
        <span class="keyword">this</span>.velocity = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);
        <span class="keyword">this</span>.target = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);

        <span class="keyword">this</span>.stiffness = stiffness;  <span class="comment">// How tight the spring is</span>
        <span class="keyword">this</span>.damping = damping;      <span class="comment">// How much it slows down</span>
    }

    <span class="function">update</span>() {
        <span class="comment">// Calculate spring force</span>
        <span class="keyword">const</span> displacement = <span class="keyword">this</span>.target.<span class="function">subtract</span>(<span class="keyword">this</span>.position);
        <span class="keyword">const</span> springForce = displacement.<span class="function">multiply</span>(<span class="keyword">this</span>.stiffness);

        <span class="comment">// Apply force to velocity</span>
        <span class="keyword">this</span>.velocity.<span class="function">add</span>(springForce);

        <span class="comment">// Apply damping (friction)</span>
        <span class="keyword">this</span>.velocity.<span class="function">multiply</span>(<span class="keyword">this</span>.damping);

        <span class="comment">// Update position</span>
        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);
    }

    <span class="function">setTarget</span>(x, y) {
        <span class="keyword">this</span>.target.<span class="function">set</span>(x, y);
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéÆ Example: Smooth Camera Follow</h4>
                    <pre><code><span class="keyword">class</span> <span class="function">Camera</span> {
    <span class="keyword">constructor</span>() {
        <span class="keyword">this</span>.spring = <span class="keyword">new</span> <span class="function">Spring</span>(<span class="number">0.08</span>, <span class="number">0.85</span>);
    }

    <span class="function">follow</span>(player) {
        <span class="comment">// Set target to player position</span>
        <span class="keyword">this</span>.spring.<span class="function">setTarget</span>(player.x, player.y);

        <span class="comment">// Update spring physics</span>
        <span class="keyword">this</span>.spring.<span class="function">update</span>();

        <span class="comment">// Camera position is spring position</span>
        <span class="keyword">this</span>.x = <span class="keyword">this</span>.spring.position.x;
        <span class="keyword">this</span>.y = <span class="keyword">this</span>.spring.position.y;
    }
}

<span class="comment">// Higher stiffness = tighter follow (0.2)</span>
<span class="comment">// Lower damping = more bouncy (0.7)</span>
<span class="comment">// Lower stiffness = looser follow (0.05)</span>
<span class="comment">// Higher damping = less bouncy (0.95)</span></code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Spring Launcher</h3>
            <div class="diagram">
                <canvas id="springDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnTightSpring">Strong Spring (k=0.2)</button>
                <button id="btnLooseSpring">Weak Spring (k=0.08)</button>
                <button id="btnBouncySpring">Medium Spring (k=0.15)</button>
                <button id="btnStiffSpring">Very Strong (k=0.25)</button>
            </div>
            <div id="springInfo" class="info-display">Click and drag near the launcher to pull back the spring and launch projectiles at the targets!</div>

            <div class="key-point">
                <strong>üí° Understanding Spring Force:</strong> The launcher demonstrates Hooke's Law (F = -k √ó displacement). Higher stiffness (k) means stronger force for the same pull distance. Try different stiffness values to see how they affect launch power and trajectory!
            </div>
        </div>

        <!-- VERLET PHYSICS -->
        <div id="verlet" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üîó Verlet Physics & Constraints</h2>

            <div class="concept-box">
                <h4>What is Verlet Integration?</h4>
                <p>Verlet integration is a simple but powerful physics technique that's perfect for simulating ropes, chains, cloth, and soft bodies. Unlike traditional force-based physics, Verlet uses position and previous position to calculate velocity implicitly.</p>

                <p><strong>Why use Verlet?</strong></p>
                <ul>
                    <li><strong>Simple:</strong> No separate velocity variable needed!</li>
                    <li><strong>Stable:</strong> More resistant to numerical errors than Euler integration</li>
                    <li><strong>Constraint-friendly:</strong> Perfect for ropes, chains, ragdolls</li>
                    <li><strong>Energy-conserving:</strong> Creates more natural motion</li>
                </ul>

                <div class="formula">
                    velocity = current_position - previous_position<br>
                    new_position = current_position + velocity + acceleration
                </div>
            </div>

            <div class="concept-box">
                <h4>Verlet vs Traditional Physics</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <tr style="background: rgba(255,255,255,0.05);">
                        <th style="padding: 10px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">Aspect</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">Euler (Force-based)</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid rgba(255,255,255,0.1);">Verlet (Position-based)</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);"><strong>Velocity</strong></td>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);">Explicit variable</td>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);">Implicit (derived from positions)</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);"><strong>Best for</strong></td>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);">Rigid bodies, projectiles</td>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);">Ropes, cloth, soft bodies</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);"><strong>Stability</strong></td>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);">Can be unstable at high speeds</td>
                        <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.1);">More stable, energy-conserving</td>
                    </tr>
                </table>
            </div>

            <details>
                <summary>üìù Click to see: Verlet Point Implementation</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">VerletPoint</span> {
    <span class="keyword">constructor</span>(x, y, pinned = <span class="keyword">false</span>) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.oldPosition = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.acceleration = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);
        <span class="keyword">this</span>.pinned = pinned;  <span class="comment">// Fixed points don't move</span>
    }

    <span class="function">update</span>(dt = <span class="number">1</span>) {
        <span class="keyword">if</span> (<span class="keyword">this</span>.pinned) <span class="keyword">return</span>;

        <span class="comment">// Calculate velocity implicitly</span>
        <span class="keyword">const</span> velocity = <span class="keyword">this</span>.position.<span class="function">copy</span>().<span class="function">subtract</span>(<span class="keyword">this</span>.oldPosition);

        <span class="comment">// Save current position</span>
        <span class="keyword">const</span> temp = <span class="keyword">this</span>.position.<span class="function">copy</span>();

        <span class="comment">// Verlet integration: new_pos = pos + velocity + acceleration</span>
        <span class="keyword">this</span>.position.<span class="function">add</span>(velocity);
        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.acceleration.<span class="function">copy</span>().<span class="function">multiply</span>(dt * dt));

        <span class="comment">// Store old position for next frame</span>
        <span class="keyword">this</span>.oldPosition = temp;

        <span class="comment">// Reset acceleration</span>
        <span class="keyword">this</span>.acceleration.<span class="function">multiply</span>(<span class="number">0</span>);
    }

    <span class="function">applyForce</span>(force) {
        <span class="keyword">this</span>.acceleration.<span class="function">add</span>(force);
    }

    <span class="function">constrain</span>(bounds) {
        <span class="comment">// Keep point within bounds (with bouncing)</span>
        <span class="keyword">if</span> (<span class="keyword">this</span>.position.x < bounds.left) {
            <span class="keyword">this</span>.position.x = bounds.left;
        }
        <span class="keyword">if</span> (<span class="keyword">this</span>.position.x > bounds.right) {
            <span class="keyword">this</span>.position.x = bounds.right;
        }
        <span class="keyword">if</span> (<span class="keyword">this</span>.position.y > bounds.bottom) {
            <span class="keyword">this</span>.position.y = bounds.bottom;
        }
        <span class="keyword">if</span> (<span class="keyword">this</span>.position.y < bounds.top) {
            <span class="keyword">this</span>.position.y = bounds.top;
        }
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üîó Constraints: The Magic of Verlet</h4>
                    <p>Constraints are what make Verlet physics special. After updating positions, we enforce constraints (like "these two points must stay exactly 50 pixels apart"). This creates rope, cloth, and rigid structures!</p>
                    <pre><code><span class="keyword">class</span> <span class="function">Constraint</span> {
    <span class="keyword">constructor</span>(p1, p2, length = <span class="keyword">null</span>) {
        <span class="keyword">this</span>.p1 = p1;
        <span class="keyword">this</span>.p2 = p2;
        <span class="comment">// If no length specified, use current distance</span>
        <span class="keyword">this</span>.length = length || p1.position.<span class="function">distance</span>(p2.position);
    }

    <span class="function">solve</span>() {
        <span class="comment">// Calculate current distance between points</span>
        <span class="keyword">const</span> diff = <span class="keyword">this</span>.p2.position.<span class="function">copy</span>().<span class="function">subtract</span>(<span class="keyword">this</span>.p1.position);
        <span class="keyword">const</span> currentDistance = diff.<span class="function">length</span>();

        <span class="comment">// Calculate how much to correct</span>
        <span class="keyword">const</span> correction = (currentDistance - <span class="keyword">this</span>.length) / currentDistance;

        <span class="comment">// Move both points to satisfy constraint</span>
        <span class="keyword">const</span> correctionVector = diff.<span class="function">multiply</span>(correction * <span class="number">0.5</span>);

        <span class="keyword">if</span> (!<span class="keyword">this</span>.p1.pinned) {
            <span class="keyword">this</span>.p1.position.<span class="function">add</span>(correctionVector);
        }

        <span class="keyword">if</span> (!<span class="keyword">this</span>.p2.pinned) {
            <span class="keyword">this</span>.p2.position.<span class="function">subtract</span>(correctionVector);
        }
    }
}</code></pre>
                </div>
            </details>

            <details>
                <summary>üìù Click to see: Complete Rope System</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">Rope</span> {
    <span class="keyword">constructor</span>(startX, startY, segments = <span class="number">10</span>, segmentLength = <span class="number">20</span>) {
        <span class="keyword">this</span>.points = [];
        <span class="keyword">this</span>.constraints = [];

        <span class="comment">// Create points along the rope</span>
        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i <= segments; i++) {
            <span class="keyword">const</span> x = startX;
            <span class="keyword">const</span> y = startY + i * segmentLength;
            <span class="keyword">const</span> pinned = (i === <span class="number">0</span>);  <span class="comment">// Pin the first point</span>

            <span class="keyword">this</span>.points.<span class="function">push</span>(<span class="keyword">new</span> <span class="function">VerletPoint</span>(x, y, pinned));
        }

        <span class="comment">// Create constraints between adjacent points</span>
        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < segments; i++) {
            <span class="keyword">const</span> constraint = <span class="keyword">new</span> <span class="function">Constraint</span>(
                <span class="keyword">this</span>.points[i],
                <span class="keyword">this</span>.points[i + <span class="number">1</span>],
                segmentLength
            );
            <span class="keyword">this</span>.constraints.<span class="function">push</span>(constraint);
        }
    }

    <span class="function">update</span>(gravity = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0.5</span>)) {
        <span class="comment">// Apply forces to all points</span>
        <span class="keyword">this</span>.points.<span class="function">forEach</span>(point => {
            point.<span class="function">applyForce</span>(gravity);
        });

        <span class="comment">// Update positions</span>
        <span class="keyword">this</span>.points.<span class="function">forEach</span>(point => {
            point.<span class="function">update</span>();
        });

        <span class="comment">// Solve constraints multiple times for stability</span>
        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < <span class="number">3</span>; i++) {
            <span class="keyword">this</span>.constraints.<span class="function">forEach</span>(constraint => {
                constraint.<span class="function">solve</span>();
            });
        }
    }

    <span class="function">draw</span>(ctx) {
        <span class="comment">// Draw the rope as connected line segments</span>
        ctx.strokeStyle = <span class="string">'#8b4513'</span>;
        ctx.lineWidth = <span class="number">3</span>;
        ctx.beginPath();
        ctx.<span class="function">moveTo</span>(<span class="keyword">this</span>.points[<span class="number">0</span>].position.x, <span class="keyword">this</span>.points[<span class="number">0</span>].position.y);

        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i < <span class="keyword">this</span>.points.length; i++) {
            ctx.<span class="function">lineTo</span>(<span class="keyword">this</span>.points[i].position.x, <span class="keyword">this</span>.points[i].position.y);
        }

        ctx.<span class="function">stroke</span>();

        <span class="comment">// Draw points</span>
        <span class="keyword">this</span>.points.<span class="function">forEach</span>(point => {
            ctx.fillStyle = point.pinned ? <span class="string">'#ff5252'</span> : <span class="string">'#42a5f5'</span>;
            ctx.beginPath();
            ctx.<span class="function">arc</span>(point.position.x, point.position.y, <span class="number">4</span>, <span class="number">0</span>, Math.PI * <span class="number">2</span>);
            ctx.<span class="function">fill</span>();
        });
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéÆ Usage Example:</h4>
                    <pre><code><span class="comment">// Create a rope hanging from the top</span>
<span class="keyword">const</span> rope = <span class="keyword">new</span> <span class="function">Rope</span>(<span class="number">400</span>, <span class="number">50</span>, <span class="number">15</span>, <span class="number">20</span>);

<span class="keyword">function</span> <span class="function">gameLoop</span>() {
    <span class="comment">// Update rope physics</span>
    rope.<span class="function">update</span>();

    <span class="comment">// Draw rope</span>
    rope.<span class="function">draw</span>(ctx);

    <span class="function">requestAnimationFrame</span>(gameLoop);
}

<span class="comment">// Make the rope interactive!</span>
canvas.<span class="function">addEventListener</span>(<span class="string">'mousemove'</span>, (e) => {
    <span class="keyword">const</span> mousePos = <span class="keyword">new</span> <span class="function">Vector2D</span>(e.offsetX, e.offsetY);

    <span class="comment">// Find closest point and apply force</span>
    rope.points.<span class="function">forEach</span>(point => {
        <span class="keyword">const</span> dist = point.position.<span class="function">distance</span>(mousePos);
        <span class="keyword">if</span> (dist < <span class="number">50</span>) {
            <span class="keyword">const</span> force = mousePos.<span class="function">subtract</span>(point.position).<span class="function">multiply</span>(<span class="number">0.02</span>);
            point.<span class="function">applyForce</span>(force);
        }
    });
});</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Verlet Physics Playground</h3>
            <p style="text-align: center; color: #9e9e9e; margin-bottom: 20px;">
                Experiment with ropes, cloth, and ragdolls! Drag points, enable wind, and try cut mode to see how constraints work.
            </p>
            <div class="diagram">
                <canvas id="verletDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnAddRope">Add Rope</button>
                <button id="btnAddCloth">Create Cloth</button>
                <button id="btnAddRagdoll">Add Ragdoll</button>
                <button id="btnToggleWind">Toggle Wind</button>
                <button id="btnCutRope">Cut Mode</button>
                <button id="btnResetVerlet">Reset</button>
            </div>
            <div id="verletInfo" class="info-display">Drag points to interact! Try the ragdoll for realistic physics. In cut mode, click constraints to cut them.</div>

            <div class="key-point">
                <strong>üí° Constraint Iterations:</strong> Notice we solve constraints multiple times per frame (usually 3-5 iterations). More iterations = more rigid/accurate constraints, but slower. Fewer iterations = more stretchy/flexible, but faster. This is a key trade-off in Verlet physics!
            </div>

            <div class="challenge-box">
                <h4>üèÜ What You Can Try:</h4>
                <ul>
                    <li><strong>‚úì Rope:</strong> Already implemented! Add ropes and drag them around.</li>
                    <li><strong>‚úì Cloth:</strong> Already implemented! See how it deforms and flows.</li>
                    <li><strong>‚úì Ragdoll:</strong> Already implemented! Add ragdolls and watch them fall naturally.</li>
                    <li><strong>Experiment:</strong> Try cutting constraints in different places to see how structures collapse!</li>
                    <li><strong>Soft Body:</strong> Create a circle of points with constraints connecting to neighbors and center</li>
                    <li><strong>Bridge:</strong> Modify rope code to pin both ends instead of just the top</li>
                    <li><strong>Chain Links:</strong> Make each segment render as a circle instead of a line</li>
                </ul>
            </div>

            <div class="thinking-prompt">
                <h4>ü§î Common Use Cases:</h4>
                <ul>
                    <li><strong>Grappling Hooks:</strong> Rope that connects player to anchor point</li>
                    <li><strong>Hair/Tail Physics:</strong> Chain of points following character</li>
                    <li><strong>Cloth/Capes:</strong> 2D grid with collision detection</li>
                    <li><strong>Bridges/Chains:</strong> Pinned at both ends</li>
                    <li><strong>Soft Body Creatures:</strong> Circular/blob-like entities</li>
                </ul>
            </div>
        </div>

        <!-- PROCEDURAL ANIMATION -->
        <div id="procedural-animation" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üé¨ Procedural Animation</h2>

            <div class="concept-box">
                <h4>What is Procedural Animation?</h4>
                <p>Instead of using pre-made keyframe animations, procedural animation generates movement through code and math! This creates organic, dynamic animations that respond to the game state.</p>
                <p><strong>Common Uses:</strong></p>
                <ul>
                    <li><strong>Idle animations:</strong> Breathing, hovering, swaying</li>
                    <li><strong>Reactive movement:</strong> Tentacles, ropes, chains</li>
                    <li><strong>Natural motion:</strong> Combining sine/cosine waves</li>
                    <li><strong>Character effects:</strong> Head bobbing, leaning</li>
                </ul>
            </div>

            <div class="concept-box">
                <h4>Core Techniques</h4>
                <p><strong>1. Sine Waves for Rhythm:</strong></p>
                <div class="formula">
                    offset = sin(time √ó frequency) √ó amplitude
                </div>
                <p><strong>2. Following Chain (Delayed Movement):</strong></p>
                <div class="formula">
                    segment[i].position.lerp(segment[i-1].position, smoothing)
                </div>
                <p><strong>3. Combining Multiple Waves:</strong></p>
                <div class="formula">
                    y = sin(t) √ó amplitude1 + sin(t √ó 2 + offset) √ó amplitude2
                </div>
            </div>

            <details>
                <summary>üìù Click to see: Procedural Animation Implementation</summary>
                <div class="code-container">
                    <pre><code><span class="comment">// Butterfly - Wing flapping with figure-8 flight pattern</span>
<span class="keyword">class</span> <span class="function">Butterfly</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.time = <span class="number">0</span>;
        <span class="keyword">this</span>.wingPhase = <span class="number">0</span>;
    }

    <span class="function">update</span>(dt) {
        <span class="keyword">this</span>.time += dt;
        <span class="keyword">this</span>.wingPhase += dt * <span class="number">12</span>; <span class="comment">// Wing flapping speed</span>

        <span class="comment">// Figure-8 flight pattern using Lissajous curve</span>
        <span class="keyword">this</span>.position.x += Math.<span class="function">sin</span>(<span class="keyword">this</span>.time * <span class="number">0.8</span>) * <span class="number">0.5</span>;
        <span class="keyword">this</span>.position.y += Math.<span class="function">sin</span>(<span class="keyword">this</span>.time * <span class="number">1.6</span>) * <span class="number">0.3</span>;
    }

    <span class="function">draw</span>(ctx) {
        <span class="comment">// Wing flapping animation</span>
        <span class="keyword">const</span> wingAngle = Math.<span class="function">sin</span>(<span class="keyword">this</span>.wingPhase) * <span class="number">0.5</span>;
        <span class="comment">// Draw wings with rotating angles...</span>
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üêü Fish - Swimming with tail wagging:</h4>
                    <pre><code><span class="keyword">class</span> <span class="function">Fish</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.velocity = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);
        <span class="keyword">this</span>.tailPhase = <span class="number">0</span>;
        <span class="keyword">this</span>.targetAngle = <span class="number">0</span>;
        <span class="keyword">this</span>.currentAngle = <span class="number">0</span>;
    }

    <span class="function">update</span>(dt) {
        <span class="keyword">this</span>.tailPhase += dt * <span class="number">8</span>;

        <span class="comment">// Smoothly rotate toward target direction</span>
        <span class="keyword">let</span> angleDiff = <span class="keyword">this</span>.targetAngle - <span class="keyword">this</span>.currentAngle;
        <span class="keyword">this</span>.currentAngle += angleDiff * dt * <span class="number">2</span>;

        <span class="comment">// Move in current direction</span>
        <span class="keyword">this</span>.velocity.x = Math.<span class="function">cos</span>(<span class="keyword">this</span>.currentAngle) * speed * dt;
        <span class="keyword">this</span>.velocity.y = Math.<span class="function">sin</span>(<span class="keyword">this</span>.currentAngle) * speed * dt;
        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);

        <span class="comment">// Tail wagging for swimming effect</span>
        <span class="keyword">const</span> tailWag = Math.<span class="function">sin</span>(<span class="keyword">this</span>.tailPhase) * <span class="number">0.4</span>;
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéê Jellyfish - Pulsing with tentacle chains:</h4>
                    <pre><code><span class="keyword">class</span> <span class="function">Jellyfish</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.tentacles = []; <span class="comment">// Array of segment chains</span>
        <span class="keyword">this</span>.pulsePhase = <span class="number">0</span>;
    }

    <span class="function">update</span>(dt) {
        <span class="keyword">this</span>.pulsePhase += dt * <span class="number">4</span>;

        <span class="comment">// Pulsing propulsion - only push when contracting</span>
        <span class="keyword">const</span> pulse = Math.<span class="function">sin</span>(<span class="keyword">this</span>.pulsePhase);
        <span class="keyword">if</span> (pulse > <span class="number">0</span>) {
            <span class="keyword">this</span>.velocity.y -= pulse * <span class="number">0.3</span>;
        }

        <span class="comment">// Update tentacles with chain following</span>
        <span class="keyword">this</span>.tentacles.<span class="function">forEach</span>(segments => {
            <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j < segments.length; j++) {
                <span class="comment">// Each segment follows previous with delay</span>
                segments[j].<span class="function">lerp</span>(segments[j - <span class="number">1</span>], <span class="number">0.15</span>);
            }
        });
    }
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Bringing Math to Life</h3>
            <p>Combine everything! Use curves for paths, noise for variation, and easing for natural motion. This creates dynamic, procedural animations that feel alive and unique every time.</p>
            <div class="diagram">
                <canvas id="proceduralDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnAddButterfly">ü¶ã Add Butterfly</button>
                <button id="btnAddFish">üêü Add Fish</button>
                <button id="btnAddJellyfish">üéê Add Jellyfish</button>
                <button id="btnClearCreatures">Clear All</button>
            </div>
            <div id="proceduralInfo" class="info-display">Watch the procedural animation magic! Click to add creatures.</div>

            <div class="key-point">
                <strong>üí° Pro Tip:</strong> Procedural animation shines when you need infinite variation or reactive behavior. Combine it with spring physics for even more organic results! Try using different frequencies and amplitudes to create unique movement patterns. Adding random phase offsets (starting positions in the sine wave) prevents entities from moving in perfect sync.
            </div>
        </div>

        <!-- WAVE SIMULATION -->
        <div id="wave-simulation" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üåä Wave Simulation</h2>

            <div class="concept-box">
                <h4>What are Waves?</h4>
                <p>Waves are oscillating disturbances that propagate through space. In games, wave simulation creates realistic water, cloth, flags, sound visualization, and force fields!</p>
                <p><strong>Key Properties:</strong></p>
                <ul>
                    <li><strong>Amplitude:</strong> Maximum displacement from rest position (wave height)</li>
                    <li><strong>Wavelength:</strong> Distance between wave peaks</li>
                    <li><strong>Frequency:</strong> How many oscillations per second</li>
                    <li><strong>Phase:</strong> Offset in time (creates wave motion)</li>
                </ul>
            </div>

            <div class="concept-box">
                <h4>Wave Equation</h4>
                <p><strong>Basic Sine Wave:</strong></p>
                <div class="formula">
                    y = amplitude √ó sin(x √ó frequency + phase)
                </div>
                <p><strong>Traveling Wave:</strong></p>
                <div class="formula">
                    y = amplitude √ó sin(x √ó frequency - time √ó speed)
                </div>
                <p>The <code>- time √ó speed</code> term makes the wave move! Positive speed moves right, negative moves left.</p>
            </div>

            <div class="concept-box">
                <h4>Types of Waves</h4>
                <p><strong>1. Standing Wave:</strong> Oscillates in place (guitar strings, flags)</p>
                <p><strong>2. Traveling Wave:</strong> Moves through space (water ripples, sound)</p>
                <p><strong>3. Interference:</strong> Multiple waves combining (ocean waves, force fields)</p>
            </div>

            <details>
                <summary>üìù Click to see: Wave Simulation Implementation</summary>
                <div class="code-container">
                    <pre><code><span class="comment">// 1D Wave System - Perfect for water surfaces, ropes, flags</span>
<span class="keyword">class</span> <span class="function">Wave1D</span> {
    <span class="keyword">constructor</span>(points, length) {
        <span class="keyword">this</span>.points = points;      <span class="comment">// Number of points in the wave</span>
        <span class="keyword">this</span>.length = length;      <span class="comment">// Physical length</span>
        <span class="keyword">this</span>.y = <span class="keyword">new</span> <span class="function">Array</span>(points).<span class="function">fill</span>(<span class="number">0</span>);       <span class="comment">// Current positions</span>
        <span class="keyword">this</span>.velocity = <span class="keyword">new</span> <span class="function">Array</span>(points).<span class="function">fill</span>(<span class="number">0</span>); <span class="comment">// Velocities</span>
        <span class="keyword">this</span>.damping = <span class="number">0.99</span>;   <span class="comment">// Energy loss (0.95-0.99 typical)</span>
        <span class="keyword">this</span>.tension = <span class="number">0.025</span>;  <span class="comment">// Wave propagation speed</span>
    }

    <span class="function">update</span>() {
        <span class="comment">// Calculate forces based on neighbors</span>
        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i < <span class="keyword">this</span>.points - <span class="number">1</span>; i++) {
            <span class="comment">// Force from left and right neighbors</span>
            <span class="keyword">const</span> force = (<span class="keyword">this</span>.y[i - <span class="number">1</span>] + <span class="keyword">this</span>.y[i + <span class="number">1</span>]) / <span class="number">2</span> - <span class="keyword">this</span>.y[i];
            <span class="keyword">this</span>.velocity[i] += force * <span class="keyword">this</span>.tension;
        }

        <span class="comment">// Apply velocities and damping</span>
        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < <span class="keyword">this</span>.points; i++) {
            <span class="keyword">this</span>.y[i] += <span class="keyword">this</span>.velocity[i];
            <span class="keyword">this</span>.velocity[i] *= <span class="keyword">this</span>.damping;
        }
    }

    <span class="function">disturb</span>(index, force) {
        <span class="comment">// Create a disturbance (like dropping a stone in water)</span>
        <span class="keyword">if</span> (index >= <span class="number">0</span> && index < <span class="keyword">this</span>.points) {
            <span class="keyword">this</span>.velocity[index] += force;
        }
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéµ Standing Wave Generator:</h4>
                    <pre><code><span class="comment">// Great for visualizing sound, vibrations, energy fields</span>
<span class="keyword">class</span> <span class="function">StandingWave</span> {
    <span class="keyword">constructor</span>(amplitude, frequency, points) {
        <span class="keyword">this</span>.amplitude = amplitude;
        <span class="keyword">this</span>.frequency = frequency;
        <span class="keyword">this</span>.points = points;
        <span class="keyword">this</span>.time = <span class="number">0</span>;
    }

    <span class="function">update</span>(dt) {
        <span class="keyword">this</span>.time += dt;
    }

    <span class="function">getY</span>(x) {
        <span class="comment">// Standing wave: oscillates in place</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.amplitude * Math.<span class="function">sin</span>(x * <span class="keyword">this</span>.frequency) * Math.<span class="function">cos</span>(<span class="keyword">this</span>.time * <span class="number">3</span>);
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üåä Traveling Wave System:</h4>
                    <pre><code><span class="comment">// Perfect for water, energy blasts, shockwaves</span>
<span class="keyword">class</span> <span class="function">TravelingWave</span> {
    <span class="keyword">constructor</span>(amplitude, wavelength, speed) {
        <span class="keyword">this</span>.amplitude = amplitude;
        <span class="keyword">this</span>.wavelength = wavelength;
        <span class="keyword">this</span>.speed = speed;
        <span class="keyword">this</span>.time = <span class="number">0</span>;
    }

    <span class="function">update</span>(dt) {
        <span class="keyword">this</span>.time += dt;
    }

    <span class="function">getY</span>(x) {
        <span class="comment">// Traveling wave: moves through space</span>
        <span class="keyword">const</span> frequency = (<span class="number">2</span> * Math.PI) / <span class="keyword">this</span>.wavelength;
        <span class="keyword">return</span> <span class="keyword">this</span>.amplitude * Math.<span class="function">sin</span>(x * frequency - <span class="keyword">this</span>.time * <span class="keyword">this</span>.speed);
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üí´ Wave Interference (Multiple Waves):</h4>
                    <pre><code><span class="comment">// Combine multiple waves for complex effects</span>
<span class="keyword">class</span> <span class="function">WaveField</span> {
    <span class="keyword">constructor</span>() {
        <span class="keyword">this</span>.sources = []; <span class="comment">// Array of {x, y, amplitude, frequency, phase}</span>
    }

    <span class="function">addSource</span>(x, y, amplitude = <span class="number">20</span>, frequency = <span class="number">0.1</span>) {
        <span class="keyword">this</span>.sources.<span class="function">push</span>({ x, y, amplitude, frequency, phase: <span class="number">0</span> });
    }

    <span class="function">update</span>(dt) {
        <span class="comment">// Advance phase of all sources</span>
        <span class="keyword">this</span>.sources.<span class="function">forEach</span>(source => {
            source.phase += dt * <span class="number">2</span>;
        });
    }

    <span class="function">getHeight</span>(x, y) {
        <span class="comment">// Sum contributions from all wave sources</span>
        <span class="keyword">let</span> height = <span class="number">0</span>;
        <span class="keyword">this</span>.sources.<span class="function">forEach</span>(source => {
            <span class="keyword">const</span> dx = x - source.x;
            <span class="keyword">const</span> dy = y - source.y;
            <span class="keyword">const</span> distance = Math.<span class="function">sqrt</span>(dx * dx + dy * dy);

            <span class="comment">// Circular wave spreading from source</span>
            height += source.amplitude * Math.<span class="function">sin</span>(distance * source.frequency - source.phase);
        });
        <span class="keyword">return</span> height;
    }
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Wave Playground</h3>
            <p>Experiment with different wave types! Click to create disturbances in the physical simulation, or watch mathematical waves travel and interfere.</p>
            <div class="diagram">
                <canvas id="waveDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnPhysicalWave">üíß Physical Wave</button>
                <button id="btnStandingWave">üéµ Standing Wave</button>
                <button id="btnTravelingWave">üåä Traveling Wave</button>
                <button id="btnInterference">üí´ Wave Interference</button>
                <button id="btnResetWaves">Reset</button>
            </div>
            <div id="waveInfo" class="info-display">Click on Physical Wave mode to create ripples!</div>

            <div class="key-point">
                <strong>üí° Pro Tip:</strong> For realistic water, combine multiple waves with different frequencies! Add small, fast ripples on top of large, slow waves. Use interference patterns for force fields and energy effects. The physical simulation (spring-based) is great for interactive water, while mathematical waves are perfect for backgrounds and visual effects.
            </div>
        </div>

        <!-- FRICTION & DRAG -->
        <div id="friction" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üí® Friction & Drag Systems</h2>

            <div class="concept-box">
                <h4>Why Friction Matters</h4>
                <p>Without friction, objects would slide forever! Friction makes movement feel grounded and realistic.</p>
                <p><strong>Two types:</strong></p>
                <ul>
                    <li><strong>Linear Friction:</strong> Simple multiplier (velocity √ó 0.98)</li>
                    <li><strong>Drag Force:</strong> Proportional to velocity squared (more realistic)</li>
                </ul>
            </div>

            <details>
                <summary>üìù Click to see: Friction Implementations</summary>
                <div class="code-container">
                    <pre><code><span class="comment">// Simple Linear Friction</span>
<span class="keyword">class</span> <span class="function">LinearFriction</span> {
    <span class="keyword">constructor</span>(coefficient = <span class="number">0.98</span>) {
        <span class="keyword">this</span>.coefficient = coefficient;  <span class="comment">// 0.98 = 2% speed loss per frame</span>
    }

    <span class="function">apply</span>(entity) {
        entity.velocity.<span class="function">multiply</span>(<span class="keyword">this</span>.coefficient);

        <span class="comment">// Stop if moving very slowly (prevent infinite drift)</span>
        <span class="keyword">if</span> (entity.velocity.<span class="function">length</span>() < <span class="number">0.01</span>) {
            entity.velocity.<span class="function">multiply</span>(<span class="number">0</span>);
        }
    }
}

<span class="comment">// Air/Fluid Drag (more realistic)</span>
<span class="keyword">class</span> <span class="function">DragForce</span> {
    <span class="keyword">constructor</span>(coefficient = <span class="number">0.01</span>) {
        <span class="keyword">this</span>.coefficient = coefficient;
    }

    <span class="function">apply</span>(entity) {
        <span class="comment">// Drag = -coefficient √ó velocity¬≤</span>
        <span class="keyword">const</span> speed = entity.velocity.<span class="function">length</span>();
        <span class="keyword">const</span> dragMagnitude = <span class="keyword">this</span>.coefficient * speed * speed;

        <span class="comment">// Apply drag in opposite direction of movement</span>
        <span class="keyword">const</span> dragForce = entity.velocity.<span class="function">copy</span>()
            .<span class="function">normalize</span>()
            .<span class="function">multiply</span>(-dragMagnitude);

        entity.<span class="function">applyForce</span>(dragForce);
    }
}

<span class="comment">// Ground Friction (only when touching ground)</span>
<span class="keyword">class</span> <span class="function">GroundFriction</span> {
    <span class="keyword">constructor</span>(coefficient = <span class="number">0.15</span>) {
        <span class="keyword">this</span>.coefficient = coefficient;
    }

    <span class="function">apply</span>(entity) {
        <span class="keyword">if</span> (entity.onGround) {
            <span class="comment">// Friction opposes horizontal movement</span>
            <span class="keyword">const</span> friction = -entity.velocity.x * <span class="keyword">this</span>.coefficient;
            entity.velocity.x += friction;
        }
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéÆ Example: Ice vs Grass vs Mud</h4>
                    <pre><code><span class="comment">// Different surfaces have different friction</span>
<span class="keyword">const</span> surfaces = {
    ice: <span class="keyword">new</span> <span class="function">LinearFriction</span>(<span class="number">0.99</span>),    <span class="comment">// Very slippery</span>
    grass: <span class="keyword">new</span> <span class="function">LinearFriction</span>(<span class="number">0.92</span>),  <span class="comment">// Normal friction</span>
    mud: <span class="keyword">new</span> <span class="function">LinearFriction</span>(<span class="number">0.80</span>)    <span class="comment">// High friction</span>
};

<span class="keyword">function</span> <span class="function">update</span>(player, currentSurface) {
    <span class="comment">// Apply appropriate friction</span>
    surfaces[currentSurface].<span class="function">apply</span>(player);

    player.position.<span class="function">add</span>(player.velocity);
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Friction Comparison</h3>
            <div class="diagram">
                <canvas id="frictionDemo" width="800" height="400"></canvas>
            </div>
            <div class="controls">
                <button id="btnNoFriction">No Friction</button>
                <button id="btnLowFriction">Low Friction (Ice)</button>
                <button id="btnMediumFriction">Medium Friction (Grass)</button>
                <button id="btnHighFriction">High Friction (Mud)</button>
            </div>
            <div id="frictionInfo" class="info-display">Click to launch objects and compare friction</div>
        </div>

        <!-- COLLISION DETECTION -->
        <div id="collision" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üí• Collision Detection</h2>

            <div class="concept-box">
                <h4>Types of Collision Detection</h4>
                <ul>
                    <li><strong>Circle vs Circle:</strong> Compare distance to sum of radii</li>
                    <li><strong>Rectangle vs Rectangle (AABB):</strong> Check overlap on both axes</li>
                    <li><strong>Circle vs Rectangle:</strong> Find closest point on rectangle to circle center</li>
                </ul>
            </div>

            <details>
                <summary>üìù Click to see: Collision Detection Functions</summary>
                <div class="code-container">
                    <pre><code><span class="comment">// Circle vs Circle</span>
<span class="keyword">function</span> <span class="function">circleVsCircle</span>(c1, r1, c2, r2) {
    <span class="keyword">const</span> distance = c1.<span class="function">distance</span>(c2);
    <span class="keyword">return</span> distance < r1 + r2;
}

<span class="comment">// AABB (Axis-Aligned Bounding Box) - Rectangle vs Rectangle</span>
<span class="keyword">function</span> <span class="function">aabbVsAabb</span>(pos1, w1, h1, pos2, w2, h2) {
    <span class="keyword">return</span> pos1.x < pos2.x + w2 &&
           pos1.x + w1 > pos2.x &&
           pos1.y < pos2.y + h2 &&
           pos1.y + h1 > pos2.y;
}

<span class="comment">// Circle vs Rectangle</span>
<span class="keyword">function</span> <span class="function">circleVsRect</span>(circlePos, radius, rectPos, width, height) {
    <span class="comment">// Find closest point on rectangle to circle</span>
    <span class="keyword">const</span> closestX = <span class="function">clamp</span>(circlePos.x, rectPos.x, rectPos.x + width);
    <span class="keyword">const</span> closestY = <span class="function">clamp</span>(circlePos.y, rectPos.y, rectPos.y + height);

    <span class="keyword">const</span> distX = circlePos.x - closestX;
    <span class="keyword">const</span> distY = circlePos.y - closestY;

    <span class="keyword">return</span> (distX * distX + distY * distY) < (radius * radius);
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Collision Detection</h3>
            <div class="diagram">
                <canvas id="collisionDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnAddCircle">Add Circle</button>
                <button id="btnAddRect">Add Rectangle</button>
                <button id="btnClearCollision">Clear All</button>
            </div>
            <div id="collisionInfo" class="info-display">Drag objects around. They'll turn red when colliding!</div>

            <div class="challenge-box">
                <h4>üèÜ Challenge: Collision Response</h4>
                <p>Try implementing these collision responses:</p>
                <ul>
                    <li>Make objects bounce off each other</li>
                    <li>Transfer momentum between colliding objects</li>
                    <li>Create "sticky" collisions that join objects together</li>
                </ul>
            </div>
        </div>

        <!-- BOUNCING & REFLECTION -->
        <div id="reflection" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>‚ö° Bouncing & Reflection</h2>

            <div class="concept-box">
                <h4>Making Things Bounce</h4>
                <p>Bouncing and reflection make physics feel satisfying! Essential for:</p>
                <ul>
                    <li>Balls bouncing off walls</li>
                    <li>Bullets ricocheting</li>
                    <li>Character wall-jumping</li>
                    <li>Pinball-style gameplay</li>
                </ul>
            </div>

            <details>
                <summary>üìù Click to see: Reflection Implementations</summary>
                <div class="code-container">
                    <pre><code><span class="comment">// Simple Axis-Aligned Reflection (walls parallel to axes)</span>
<span class="keyword">function</span> <span class="function">bounceOffWalls</span>(object, bounds, bounciness = <span class="number">0.8</span>) {
    <span class="comment">// Right wall</span>
    <span class="keyword">if</span> (object.position.x + object.radius > bounds.right) {
        object.position.x = bounds.right - object.radius;
        object.velocity.x *= -bounciness;  <span class="comment">// Reverse and reduce</span>
    }

    <span class="comment">// Left wall</span>
    <span class="keyword">if</span> (object.position.x - object.radius < bounds.left) {
        object.position.x = bounds.left + object.radius;
        object.velocity.x *= -bounciness;
    }

    <span class="comment">// Bottom wall</span>
    <span class="keyword">if</span> (object.position.y + object.radius > bounds.bottom) {
        object.position.y = bounds.bottom - object.radius;
        object.velocity.y *= -bounciness;
    }

    <span class="comment">// Top wall</span>
    <span class="keyword">if</span> (object.position.y - object.radius < bounds.top) {
        object.position.y = bounds.top + object.radius;
        object.velocity.y *= -bounciness;
    }
}

<span class="comment">// Reflection Off Any Surface (using surface normal)</span>
<span class="keyword">function</span> <span class="function">reflect</span>(velocity, surfaceNormal) {
    <span class="comment">// Formula: v' = v - 2(v ¬∑ n)n</span>
    <span class="comment">// Where n is the surface normal (unit vector)</span>
    <span class="keyword">const</span> dotProduct = velocity.<span class="function">dot</span>(surfaceNormal);
    <span class="keyword">const</span> reflection = surfaceNormal
        .<span class="function">copy</span>()
        .<span class="function">multiply</span>(<span class="number">2</span> * dotProduct);

    <span class="keyword">return</span> velocity.<span class="function">subtract</span>(reflection);
}

<span class="comment">// Circle Bouncing Off Circle</span>
<span class="keyword">function</span> <span class="function">bounceCircles</span>(a, b, elasticity = <span class="number">0.9</span>) {
    <span class="comment">// Get collision normal (from b to a)</span>
    <span class="keyword">const</span> normal = a.position.<span class="function">subtract</span>(b.position).<span class="function">normalize</span>();

    <span class="comment">// Relative velocity</span>
    <span class="keyword">const</span> relativeVel = a.velocity.<span class="function">subtract</span>(b.velocity);

    <span class="comment">// Velocity along collision normal</span>
    <span class="keyword">const</span> speed = relativeVel.<span class="function">dot</span>(normal);

    <span class="comment">// Don't bounce if moving apart</span>
    <span class="keyword">if</span> (speed > <span class="number">0</span>) <span class="keyword">return</span>;

    <span class="comment">// Calculate impulse (considering mass)</span>
    <span class="keyword">const</span> impulse = (<span class="number">2</span> * speed) / (a.mass + b.mass);

    <span class="comment">// Apply impulse to both objects</span>
    a.velocity.<span class="function">subtract</span>(normal.<span class="function">copy</span>().<span class="function">multiply</span>(impulse * b.mass * elasticity));
    b.velocity.<span class="function">add</span>(normal.<span class="function">copy</span>().<span class="function">multiply</span>(impulse * a.mass * elasticity));

    <span class="comment">// Separate objects to prevent overlap</span>
    <span class="keyword">const</span> overlap = (a.radius + b.radius) - a.position.<span class="function">distance</span>(b.position);
    <span class="keyword">if</span> (overlap > <span class="number">0</span>) {
        <span class="keyword">const</span> separation = normal.<span class="function">copy</span>().<span class="function">multiply</span>(overlap / <span class="number">2</span>);
        a.position.<span class="function">add</span>(separation);
        b.position.<span class="function">subtract</span>(separation);
    }
}</code></pre>
                </div>

                <div class="example-box">
                    <h4>üéÆ Example: Breakout/Pong Ball</h4>
                    <pre><code><span class="keyword">class</span> <span class="function">Ball</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.velocity = <span class="keyword">new</span> <span class="function">Vector2D</span>(<span class="number">5</span>, <span class="number">5</span>);
        <span class="keyword">this</span>.radius = <span class="number">10</span>;
        <span class="keyword">this</span>.bounciness = <span class="number">1.0</span>;  <span class="comment">// Perfect bounce</span>
    }

    <span class="function">update</span>(bounds) {
        <span class="comment">// Move ball</span>
        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);

        <span class="comment">// Bounce off walls</span>
        <span class="function">bounceOffWalls</span>(<span class="keyword">this</span>, bounds, <span class="keyword">this</span>.bounciness);
    }

    <span class="function">hitPaddle</span>(paddle) {
        <span class="comment">// Reflect based on where it hit the paddle</span>
        <span class="keyword">const</span> relativeHit = (<span class="keyword">this</span>.position.x - paddle.x) / (paddle.width / <span class="number">2</span>);
        <span class="keyword">const</span> angle = relativeHit * (Math.PI / <span class="number">4</span>);  <span class="comment">// Max 45 degrees</span>

        <span class="keyword">const</span> speed = <span class="keyword">this</span>.velocity.<span class="function">length</span>();
        <span class="keyword">this</span>.velocity.x = Math.<span class="function">sin</span>(angle) * speed;
        <span class="keyword">this</span>.velocity.y = -Math.<span class="function">abs</span>(Math.<span class="function">cos</span>(angle) * speed);
    }
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Bouncing Physics</h3>
            <div class="diagram">
                <canvas id="reflectionDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnPerfectBounce">Perfect Bounce (1.0)</button>
                <button id="btnNormalBounce">Normal Bounce (0.8)</button>
                <button id="btnDeadBounce">Dead Bounce (0.3)</button>
                <button id="btnCircleBounce">Circle Collisions</button>
            </div>
            <div id="reflectionInfo" class="info-display">Click to add bouncing balls</div>

            <div class="key-point">
                <strong>üí° Bounciness Values:</strong> 1.0 = perfect elastic collision (no energy loss), 0.5 = loses half the energy, 0.0 = no bounce (sticks to surface). Real materials: rubber ‚âà 0.8, wood ‚âà 0.5, clay ‚âà 0.1
            </div>
        </div>

        <!-- RAYCASTING -->
        <div id="raycasting" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üëÅÔ∏è Raycasting & Line of Sight</h2>

            <div class="concept-box">
                <h4>What is Raycasting?</h4>
                <p>Raycasting shoots an invisible line (ray) from a point in a direction to check what it hits. Used for:</p>
                <ul>
                    <li><strong>Line of sight:</strong> Can the enemy see the player?</li>
                    <li><strong>Shooting:</strong> What did the bullet hit?</li>
                    <li><strong>Mouse picking:</strong> What object did the user click?</li>
                    <li><strong>Pathfinding:</strong> Is there a wall in the way?</li>
                </ul>
            </div>

            <details>
                <summary>üìù Click to see: Ray Class</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">Ray</span> {
    <span class="keyword">constructor</span>(origin, direction) {
        <span class="keyword">this</span>.origin = origin.<span class="function">copy</span>();
        <span class="keyword">this</span>.direction = direction.<span class="function">copy</span>().<span class="function">normalize</span>();
    }

    <span class="comment">// Check if ray intersects with a circle</span>
    <span class="function">intersectsCircle</span>(center, radius) {
        <span class="keyword">const</span> oc = <span class="keyword">this</span>.origin.<span class="function">subtract</span>(center);
        <span class="keyword">const</span> a = <span class="keyword">this</span>.direction.<span class="function">dot</span>(<span class="keyword">this</span>.direction);
        <span class="keyword">const</span> b = <span class="number">2</span> * oc.<span class="function">dot</span>(<span class="keyword">this</span>.direction);
        <span class="keyword">const</span> c = oc.<span class="function">dot</span>(oc) - radius * radius;

        <span class="keyword">const</span> discriminant = b * b - <span class="number">4</span> * a * c;
        <span class="keyword">return</span> discriminant >= <span class="number">0</span>;
    }

    <span class="comment">// Get point along ray at distance t</span>
    <span class="function">pointAt</span>(t) {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="function">Vector2D</span>(
            <span class="keyword">this</span>.origin.x + <span class="keyword">this</span>.direction.x * t,
            <span class="keyword">this</span>.origin.y + <span class="keyword">this</span>.direction.y * t
        );
    }
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Raycasting</h3>
            <div class="diagram">
                <canvas id="raycastDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnAddObstacle">Add Obstacle</button>
                <button id="btnClearRaycast">Clear Obstacles</button>
            </div>
            <div id="raycastInfo" class="info-display">Move your mouse. Rays turn red when they hit objects!</div>
        </div>

        <!-- PARTICLE SYSTEMS -->
        <div id="particles" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>‚ú® Particle Systems</h2>

            <div class="concept-box">
                <h4>What are Particle Systems?</h4>
                <p>Particle systems create visual effects using many small objects (particles). Used for:</p>
                <ul>
                    <li>Explosions and fire</li>
                    <li>Smoke and steam</li>
                    <li>Rain and snow</li>
                    <li>Magic spells and trails</li>
                </ul>
            </div>

            <details>
                <summary>üìù Click to see: Particle System</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">Particle</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">this</span>.position = <span class="keyword">new</span> <span class="function">Vector2D</span>(x, y);
        <span class="keyword">this</span>.velocity = Vector2D.<span class="function">random</span>(<span class="function">randomFloat</span>(<span class="number">1</span>, <span class="number">5</span>));
        <span class="keyword">this</span>.life = <span class="number">1.0</span>;
        <span class="keyword">this</span>.decay = <span class="function">randomFloat</span>(<span class="number">0.01</span>, <span class="number">0.03</span>);
        <span class="keyword">this</span>.size = <span class="function">randomFloat</span>(<span class="number">2</span>, <span class="number">8</span>);
    }

    <span class="function">update</span>() {
        <span class="keyword">this</span>.velocity.<span class="function">multiply</span>(<span class="number">0.98</span>);  <span class="comment">// Friction</span>
        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);
        <span class="keyword">this</span>.life -= <span class="keyword">this</span>.decay;
        <span class="keyword">return</span> <span class="keyword">this</span>.life > <span class="number">0</span>;
    }

    <span class="function">draw</span>(ctx) {
        ctx.globalAlpha = <span class="keyword">this</span>.life;
        ctx.fillStyle = <span class="string">'#ffa726'</span>;
        ctx.beginPath();
        ctx.<span class="function">arc</span>(<span class="keyword">this</span>.position.x, <span class="keyword">this</span>.position.y, <span class="keyword">this</span>.size, <span class="number">0</span>, Math.PI * <span class="number">2</span>);
        ctx.<span class="function">fill</span>();
        ctx.globalAlpha = <span class="number">1</span>;
    }
}

<span class="keyword">class</span> <span class="function">ParticleSystem</span> {
    <span class="keyword">constructor</span>() {
        <span class="keyword">this</span>.particles = [];
    }

    <span class="function">emit</span>(x, y, count = <span class="number">20</span>) {
        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < count; i++) {
            <span class="keyword">this</span>.particles.<span class="function">push</span>(<span class="keyword">new</span> <span class="function">Particle</span>(x, y));
        }
    }

    <span class="function">update</span>() {
        <span class="keyword">this</span>.particles = <span class="keyword">this</span>.particles.<span class="function">filter</span>(p => p.<span class="function">update</span>());
    }

    <span class="function">draw</span>(ctx) {
        <span class="keyword">this</span>.particles.<span class="function">forEach</span>(p => p.<span class="function">draw</span>(ctx));
    }
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Particle Effects</h3>
            <div class="diagram">
                <canvas id="particleDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnExplosion">Explosion</button>
                <button id="btnFountain">Fountain</button>
                <button id="btnTrail">Trail Mode</button>
            </div>
            <div id="particleInfo" class="info-display">Click anywhere to create particles!</div>

            <div class="thinking-prompt">
                <h4>ü§î Think About It:</h4>
                <p>What happens if you create thousands of particles? How would you optimize the system to handle many effects at once?</p>
                <p><em>Hint: Check out the Expert guide's section on Object Pooling!</em></p>
            </div>
        </div>

        <!-- ADVANCED PARTICLE EFFECTS -->
        <div id="advanced-particles" class="section">
            <span class="level-indicator level-intermediate">INTERMEDIATE</span>
            <h2>üåü Advanced Particle Effects</h2>

            <div class="concept-box">
                <h4>Creating Specific Effects</h4>
                <p>Different particle behaviors create different visual effects. Let's build systems for common game effects!</p>
            </div>

            <h3>Effect Types</h3>

            <details>
                <summary>üìù Effect 1: Fire & Flames</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">FireParticle</span> <span class="keyword">extends</span> <span class="function">Particle</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">super</span>(x, y);

        <span class="comment">// Fire rises and spreads</span>
        <span class="keyword">this</span>.velocity.y = -<span class="function">random</span>(<span class="number">1</span>, <span class="number">3</span>);  <span class="comment">// Upward</span>
        <span class="keyword">this</span>.velocity.x = <span class="function">random</span>(-<span class="number">0.5</span>, <span class="number">0.5</span>);  <span class="comment">// Slight spread</span>

        <span class="keyword">this</span>.size = <span class="function">random</span>(<span class="number">4</span>, <span class="number">12</span>);
        <span class="keyword">this</span>.life = <span class="number">1.0</span>;
        <span class="keyword">this</span>.decay = <span class="function">random</span>(<span class="number">0.02</span>, <span class="number">0.04</span>);

        <span class="comment">// Color transitions: yellow ‚Üí orange ‚Üí red ‚Üí transparent</span>
        <span class="keyword">this</span>.colors = [
            { r: <span class="number">255</span>, g: <span class="number">255</span>, b: <span class="number">100</span> },  <span class="comment">// Bright yellow</span>
            { r: <span class="number">255</span>, g: <span class="number">150</span>, b: <span class="number">50</span> },   <span class="comment">// Orange</span>
            { r: <span class="number">255</span>, g: <span class="number">50</span>, b: <span class="number">50</span> }     <span class="comment">// Red</span>
        ];
    }

    <span class="function">update</span>() {
        <span class="keyword">this</span>.life -= <span class="keyword">this</span>.decay;

        <span class="comment">// Accelerate upward (heat rises!)</span>
        <span class="keyword">this</span>.velocity.y -= <span class="number">0.05</span>;

        <span class="comment">// Shrink as it burns out</span>
        <span class="keyword">this</span>.size *= <span class="number">0.98</span>;

        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);

        <span class="keyword">return</span> <span class="keyword">this</span>.life > <span class="number">0</span>;
    }

    <span class="function">draw</span>(ctx) {
        <span class="comment">// Interpolate color based on life</span>
        <span class="keyword">const</span> colorIndex = Math.<span class="function">floor</span>((<span class="number">1</span> - <span class="keyword">this</span>.life) * <span class="number">2</span>);
        <span class="keyword">const</span> color = <span class="keyword">this</span>.colors[Math.<span class="function">min</span>(colorIndex, <span class="number">2</span>)];

        ctx.globalAlpha = <span class="keyword">this</span>.life;
        ctx.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;
        ctx.beginPath();
        ctx.<span class="function">arc</span>(<span class="keyword">this</span>.position.x, <span class="keyword">this</span>.position.y,
                 <span class="keyword">this</span>.size, <span class="number">0</span>, Math.PI * <span class="number">2</span>);
        ctx.<span class="function">fill</span>();
        ctx.globalAlpha = <span class="number">1</span>;
    }
}</code></pre>
                </div>
            </details>

            <details>
                <summary>üìù Effect 2: Smoke</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">SmokeParticle</span> <span class="keyword">extends</span> <span class="function">Particle</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">super</span>(x, y);

        <span class="comment">// Smoke drifts slowly upward</span>
        <span class="keyword">this</span>.velocity.y = -<span class="function">random</span>(<span class="number">0.3</span>, <span class="number">0.8</span>);
        <span class="keyword">this</span>.velocity.x = <span class="function">random</span>(-<span class="number">0.3</span>, <span class="number">0.3</span>);

        <span class="keyword">this</span>.size = <span class="function">random</span>(<span class="number">8</span>, <span class="number">20</span>);
        <span class="keyword">this</span>.life = <span class="number">1.0</span>;
        <span class="keyword">this</span>.decay = <span class="function">random</span>(<span class="number">0.005</span>, <span class="number">0.015</span>);  <span class="comment">// Lasts longer</span>

        <span class="comment">// Swirl effect</span>
        <span class="keyword">this</span>.angle = <span class="function">random</span>(<span class="number">0</span>, Math.PI * <span class="number">2</span>);
        <span class="keyword">this</span>.swirl = <span class="function">random</span>(-<span class="number">0.02</span>, <span class="number">0.02</span>);
    }

    <span class="function">update</span>() {
        <span class="keyword">this</span>.life -= <span class="keyword">this</span>.decay;

        <span class="comment">// Swirl motion</span>
        <span class="keyword">this</span>.angle += <span class="keyword">this</span>.swirl;
        <span class="keyword">this</span>.velocity.x += Math.<span class="function">cos</span>(<span class="keyword">this</span>.angle) * <span class="number">0.05</span>;

        <span class="comment">// Expand as it dissipates</span>
        <span class="keyword">this</span>.size += <span class="number">0.2</span>;

        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);

        <span class="keyword">return</span> <span class="keyword">this</span>.life > <span class="number">0</span>;
    }

    <span class="function">draw</span>(ctx) {
        <span class="comment">// Gray smoke, fades with life</span>
        <span class="keyword">const</span> gray = Math.<span class="function">floor</span>(<span class="number">100</span> + <span class="keyword">this</span>.life * <span class="number">100</span>);
        ctx.globalAlpha = <span class="keyword">this</span>.life * <span class="number">0.4</span>;  <span class="comment">// Semi-transparent</span>
        ctx.fillStyle = `rgb(${gray}, ${gray}, ${gray})`;
        ctx.beginPath();
        ctx.<span class="function">arc</span>(<span class="keyword">this</span>.position.x, <span class="keyword">this</span>.position.y,
                 <span class="keyword">this</span>.size, <span class="number">0</span>, Math.PI * <span class="number">2</span>);
        ctx.<span class="function">fill</span>();
        ctx.globalAlpha = <span class="number">1</span>;
    }
}</code></pre>
                </div>
            </details>

            <details>
                <summary>üìù Effect 3: Sparkles/Magic</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">SparkleParticle</span> <span class="keyword">extends</span> <span class="function">Particle</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">super</span>(x, y);

        <span class="comment">// Sparkles burst outward</span>
        <span class="keyword">const</span> angle = <span class="function">random</span>(<span class="number">0</span>, Math.PI * <span class="number">2</span>);
        <span class="keyword">const</span> speed = <span class="function">random</span>(<span class="number">2</span>, <span class="number">5</span>);
        <span class="keyword">this</span>.velocity.x = Math.<span class="function">cos</span>(angle) * speed;
        <span class="keyword">this</span>.velocity.y = Math.<span class="function">sin</span>(angle) * speed;

        <span class="keyword">this</span>.size = <span class="function">random</span>(<span class="number">2</span>, <span class="number">6</span>);
        <span class="keyword">this</span>.life = <span class="number">1.0</span>;
        <span class="keyword">this</span>.decay = <span class="function">random</span>(<span class="number">0.03</span>, <span class="number">0.06</span>);

        <span class="comment">// Random bright color</span>
        <span class="keyword">this</span>.hue = <span class="function">random</span>(<span class="number">0</span>, <span class="number">360</span>);

        <span class="comment">// Twinkle effect</span>
        <span class="keyword">this</span>.twinkle = <span class="number">0</span>;
    }

    <span class="function">update</span>() {
        <span class="keyword">this</span>.life -= <span class="keyword">this</span>.decay;

        <span class="comment">// Slow down over time</span>
        <span class="keyword">this</span>.velocity.<span class="function">multiply</span>(<span class="number">0.95</span>);

        <span class="comment">// Twinkle animation</span>
        <span class="keyword">this</span>.twinkle += <span class="number">0.2</span>;
        <span class="keyword">const</span> scale = Math.<span class="function">abs</span>(Math.<span class="function">sin</span>(<span class="keyword">this</span>.twinkle));

        <span class="keyword">this</span>.currentSize = <span class="keyword">this</span>.size * scale;

        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);

        <span class="keyword">return</span> <span class="keyword">this</span>.life > <span class="number">0</span>;
    }

    <span class="function">draw</span>(ctx) {
        ctx.globalAlpha = <span class="keyword">this</span>.life;
        ctx.fillStyle = `hsl(${<span class="keyword">this</span>.hue}, 100%, 70%)`;

        <span class="comment">// Draw as a star/cross shape</span>
        <span class="keyword">const</span> s = <span class="keyword">this</span>.currentSize;
        ctx.beginPath();
        ctx.<span class="function">moveTo</span>(<span class="keyword">this</span>.position.x - s, <span class="keyword">this</span>.position.y);
        ctx.<span class="function">lineTo</span>(<span class="keyword">this</span>.position.x + s, <span class="keyword">this</span>.position.y);
        ctx.<span class="function">moveTo</span>(<span class="keyword">this</span>.position.x, <span class="keyword">this</span>.position.y - s);
        ctx.<span class="function">lineTo</span>(<span class="keyword">this</span>.position.x, <span class="keyword">this</span>.position.y + s);
        ctx.lineWidth = <span class="number">2</span>;
        ctx.strokeStyle = `hsl(${<span class="keyword">this</span>.hue}, 100%, 90%)`;
        ctx.<span class="function">stroke</span>();

        ctx.globalAlpha = <span class="number">1</span>;
    }
}</code></pre>
                </div>
            </details>

            <details>
                <summary>üìù Effect 4: Rain & Water</summary>
                <div class="code-container">
                    <pre><code><span class="keyword">class</span> <span class="function">RainParticle</span> <span class="keyword">extends</span> <span class="function">Particle</span> {
    <span class="keyword">constructor</span>(x, y) {
        <span class="keyword">super</span>(x, y);

        <span class="comment">// Rain falls down with slight wind</span>
        <span class="keyword">this</span>.velocity.y = <span class="function">random</span>(<span class="number">5</span>, <span class="number">10</span>);
        <span class="keyword">this</span>.velocity.x = <span class="function">random</span>(-<span class="number">1</span>, <span class="number">1</span>);  <span class="comment">// Wind effect</span>

        <span class="keyword">this</span>.length = <span class="function">random</span>(<span class="number">10</span>, <span class="number">20</span>);
        <span class="keyword">this</span>.life = <span class="number">1.0</span>;
        <span class="keyword">this</span>.decay = <span class="number">0</span>;  <span class="comment">// Doesn't fade until hitting ground</span>
    }

    <span class="function">update</span>(groundY = <span class="number">600</span>) {
        <span class="comment">// Accelerate (gravity)</span>
        <span class="keyword">this</span>.velocity.y += <span class="number">0.2</span>;

        <span class="keyword">this</span>.position.<span class="function">add</span>(<span class="keyword">this</span>.velocity);

        <span class="comment">// Hit ground - create splash!</span>
        <span class="keyword">if</span> (<span class="keyword">this</span>.position.y >= groundY) {
            <span class="keyword">this</span>.<span class="function">createSplash</span>();
            <span class="keyword">return</span> <span class="keyword">false</span>;  <span class="comment">// Remove raindrop</span>
        }

        <span class="keyword">return</span> <span class="keyword">true</span>;
    }

    <span class="function">draw</span>(ctx) {
        ctx.strokeStyle = <span class="string">'rgba(150, 150, 255, 0.5)'</span>;
        ctx.lineWidth = <span class="number">2</span>;
        ctx.beginPath();
        ctx.<span class="function">moveTo</span>(<span class="keyword">this</span>.position.x, <span class="keyword">this</span>.position.y);
        ctx.<span class="function">lineTo</span>(
            <span class="keyword">this</span>.position.x - <span class="keyword">this</span>.velocity.x * <span class="number">0.3</span>,
            <span class="keyword">this</span>.position.y - <span class="keyword">this</span>.length
        );
        ctx.<span class="function">stroke</span>();
    }

    <span class="function">createSplash</span>() {
        <span class="comment">// Create small splash particles (handled by particle system)</span>
        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < <span class="number">5</span>; i++) {
            <span class="keyword">const</span> angle = <span class="function">random</span>(-Math.PI, <span class="number">0</span>);  <span class="comment">// Upward hemisphere</span>
            <span class="keyword">const</span> speed = <span class="function">random</span>(<span class="number">1</span>, <span class="number">3</span>);
            <span class="comment">// Emit splash particles...</span>
        }
    }
}</code></pre>
                </div>
            </details>

            <h3>Interactive Demo: Particle Effect Showcase</h3>
            <div class="diagram">
                <canvas id="advancedParticlesDemo" width="800" height="500"></canvas>
            </div>
            <div class="controls">
                <button id="btnFire">üî• Fire</button>
                <button id="btnSmoke">üí® Smoke</button>
                <button id="btnSparkles">‚ú® Sparkles</button>
                <button id="btnRain">üåßÔ∏è Rain</button>
                <button id="btnCombined">üéÜ Combined Effects</button>
                <button id="btnClearParticles">Clear All</button>
            </div>
            <div id="advancedParticlesInfo" class="info-display">Click to create different particle effects!</div>

            <div class="key-point">
                <strong>üí° Pro Tip:</strong> Combine multiple particle types for complex effects! A campfire = fire particles + smoke particles + occasional sparkles. An explosion = fast-moving sparkles + fire burst + smoke trail!
            </div>
        </div>

        <!-- Next Steps -->
        <div class="section" style="text-align: center;">
            <h2>üéâ Great Progress!</h2>
            <p style="font-size: 1.2em; margin: 30px 0;">
                You now understand core game systems! Ready for advanced techniques?
            </p>
            <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                <a href="beginner.html" class="nav-button">‚Üê Review Basics</a>
                <a href="advanced.html" class="nav-button" style="font-size: 1.2em; padding: 20px 40px;">
                    Continue to Advanced ‚Üí
                </a>
            </div>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <div class="scroll-to-top" id="scrollToTop">‚Üë</div>

    <!-- Load shared utilities -->
    <script src="shared/utils.js"></script>

    <!-- Page-specific JavaScript -->
    <script src="intermediate-demos.js"></script>
</body>
</html>
